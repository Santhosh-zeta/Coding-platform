<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Runner</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter & Roboto Mono -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Custom CSS for styling and theme -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827; /* Dark blue-gray background */
            color: #d1d5db; /* Light gray text */
        }
        /* Custom scrollbar for a better look */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #1f2937; }
        ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #6b7280; }
        
        /* Style for the textareas */
        #codeInput, #problemInput {
            font-family: 'Roboto Mono', monospace;
            tab-size: 4; -moz-tab-size: 4; -o-tab-size: 4;
            background-color: #1f2937;
            border-color: #374151;
            caret-color: #34d399;
        }
        #problemInput { font-family: 'Inter', sans-serif; }
        
        /* Custom console output styling */
        .console-log { color: #e5e7eb; white-space: pre-wrap; word-break: break-word; }
        .console-log-debug { color: #60a5fa; font-style: italic; }
        .console-error { color: #f87171; font-weight: 500; white-space: pre-wrap; word-break: break-word; }
        
        /* Spinner animation */
        .spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #6366f1;
            border-radius: 50%;
            width: 16px; height: 16px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Tab styling */
        .tab-btn {
            transition: all 0.2s ease-in-out;
            border-bottom: 2px solid transparent;
        }
        .tab-btn.active {
            color: #a78bfa; /* Violet-400 */
            border-bottom-color: #a78bfa;
        }
    </style>
</head>
<body class="h-screen max-h-screen flex flex-col">
    <!-- Header -->
    <header class="bg-gray-900/80 backdrop-blur-sm border-b border-gray-700 shadow-lg z-10">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center space-x-3">
                    <svg class="w-8 h-8 text-emerald-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 7.5l3 2.25-3 2.25m4.5 0h3m-9 8.25h13.5A2.25 2.25 0 0021 18V6a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 6v12a2.25 2.25 0 002.25 2.25z" />
                    </svg>
                    <h1 class="text-xl font-bold text-white">Code Runner</h1>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="flex-grow container mx-auto p-4 sm:p-6 lg:p-8 flex flex-col md:flex-row gap-6 overflow-hidden">
        
        <!-- Left Pane: Problem Description -->
        <div class="w-full md:w-2/5 flex flex-col">
            <div class="bg-gray-800 rounded-xl shadow-md border border-gray-700 flex flex-col flex-grow">
                <h2 class="text-lg font-semibold text-emerald-400 mb-3 p-6 pb-0">Problem Description</h2>
                <div class="p-6 pt-3 flex-grow">
                    <textarea id="problemInput" class="w-full h-full p-3 text-sm bg-gray-900 text-gray-200 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 rounded-lg resize-none" placeholder="Enter the problem description for the AI to analyze against.&#10;For example: 'Write a function to find the maximum number in an array.'"></textarea>
                </div>
            </div>
        </div>

        <!-- Right Pane: Editor and Output/Analysis -->
        <div class="w-full md:w-3/5 flex flex-col gap-6">
            <!-- Top Right: Code Editor -->
            <div class="h-1/2 flex flex-col bg-gray-800 rounded-xl shadow-md border border-gray-700 overflow-hidden">
                <!-- Editor Controls -->
                <div class="flex items-center justify-between p-3 bg-gray-900 border-b border-gray-700">
                    <div class="relative">
                        <select id="languageSelect" class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-emerald-500 focus:border-emerald-500 block w-full pl-3 pr-8 py-2 appearance-none">
                            <option value="javascript">JavaScript</option>
                            <option value="java">Java</option>
                            <option value="c">C</option>
                            <option value="cpp">C++</option>
                        </select>
                        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-400">
                            <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <button id="analyzeBtn" class="flex items-center gap-2 bg-violet-600 hover:bg-violet-700 text-white font-bold py-2 px-4 rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-violet-500 focus:ring-opacity-50">
                            âœ¨ Analyze
                            <span id="analyzeSpinner" class="hidden spinner"></span>
                        </button>
                        <button id="debugBtn" class="flex items-center gap-2 bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:ring-opacity-50">
                            Debug
                            <span id="debugSpinner" class="hidden spinner"></span>
                        </button>
                        <button id="runBtn" class="flex items-center gap-2 bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-2 px-4 rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-opacity-50">
                            Run
                            <span id="runSpinner" class="hidden spinner"></span>
                        </button>
                    </div>
                </div>
                <!-- Textarea for code -->
                <div class="flex-grow p-1">
                     <textarea id="codeInput" class="w-full h-full p-4 text-base bg-gray-900 text-gray-200 border-2 border-transparent focus:outline-none focus:border-emerald-500 rounded-b-lg resize-none" spellcheck="false" placeholder="Write your code here..."></textarea>
                </div>
            </div>

            <!-- Bottom Right: Tabs for Output & AI Analysis -->
            <div class="h-1/2 flex flex-col bg-gray-800 rounded-xl shadow-md border border-gray-700 overflow-hidden">
                <!-- Tab Headers -->
                <div class="flex border-b border-gray-700 bg-gray-900">
                    <button data-tab="outputTab" class="tab-btn active font-semibold text-blue-400 py-2 px-4">Output Console</button>
                    <button data-tab="aiTab" class="tab-btn font-semibold text-violet-400 py-2 px-4">AI Code Analysis</button>
                </div>
                <!-- Tab Content -->
                <div class="flex-grow p-6 overflow-auto">
                    <!-- Output Panel -->
                    <div id="outputTab" class="tab-content">
                        <div id="output" class="font-mono text-sm">
                            <span class="text-gray-500">Click "Run" or "Debug" to see the output here...</span>
                        </div>
                    </div>
                    <!-- AI Analysis Panel -->
                    <div id="aiTab" class="tab-content hidden">
                        <div id="aiAnalysisOutput" class="text-sm">
                            <span class="text-gray-500">Enter a problem and code, then click "Analyze" to get AI feedback...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <script>
        // DOM Element References
        const codeInput = document.getElementById('codeInput');
        const outputConsole = document.getElementById('output');
        const runBtn = document.getElementById('runBtn');
        const debugBtn = document.getElementById('debugBtn');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const languageSelect = document.getElementById('languageSelect');
        const runSpinner = document.getElementById('runSpinner');
        const debugSpinner = document.getElementById('debugSpinner');
        const analyzeSpinner = document.getElementById('analyzeSpinner');
        const aiAnalysisOutput = document.getElementById('aiAnalysisOutput');
        const problemInput = document.getElementById('problemInput');
        const tabButtons = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');

        // Store the original console.log function
        const originalConsoleLog = console.log;

        // --- Core Logic ---
        const executeCode = (isDebugMode = false) => {
            const code = codeInput.value;
            const selectedLanguage = languageSelect.value;
            outputConsole.innerHTML = ''; 

            if (selectedLanguage !== 'javascript') {
                outputConsole.innerHTML = `<div class="console-error">Sorry, direct execution is only supported for JavaScript in this browser environment. You can still analyze this code with Gemini.</div>`;
                return;
            }

            console.log = function(...args) {
                const message = args.map(arg => typeof arg === 'object' && arg !== null ? JSON.stringify(arg, null, 2) : String(arg)).join(' ');
                const logClass = isDebugMode ? 'console-log-debug' : 'console-log';
                outputConsole.innerHTML += `<div class="${logClass}">> ${message}</div>`;
            };
            
            try {
                if (isDebugMode) console.log('--- DEBUG MODE: Execution Started ---');
                new Function(code)();
                if (isDebugMode) console.log('--- DEBUG MODE: Execution Finished ---');
            } catch (error) {
                outputConsole.innerHTML += `<div class="console-error">Error: ${error.name} - ${error.message}</div>`;
            } finally {
                console.log = originalConsoleLog;
            }
        };

        // --- Gemini API Analysis Logic ---
        async function getGeminiAnalysis(problem, code, language) {
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            const systemPrompt = `You are an expert code reviewer for a student learning to code. Analyze their code based on a given problem. Provide a suitability score (0-100) and constructive, encouraging suggestions. Respond in a valid JSON format: {"score": <number>, "suggestions": ["<string>", ...]}. Highlight key terms using markdown bold (**term**).`;
            const userQuery = `Problem Description: "${problem}"\n\nStudent's Code in ${language}:\n\`\`\`${language}\n${code}\n\`\`\``;

            const payload = {
                systemInstruction: { parts: [{ text: systemPrompt }] },
                contents: [{ parts: [{ text: userQuery }] }],
                generationConfig: { responseMimeType: "application/json" }
            };

            try {
                let response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) throw new Error(`API request failed with status ${response.status}`);
                const result = await response.json();
                const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                if (text) return JSON.parse(text);
                throw new Error("Invalid response structure from API.");
            } catch (error) {
                originalConsoleLog("Gemini API Error:", error);
                return { score: 0, suggestions: [`**Error:** Could not get analysis from Gemini. Please check the console for details.`] };
            }
        }

        const displayAIAnalysis = (analysis) => {
            if (!analysis) {
                aiAnalysisOutput.innerHTML = `<p class="text-red-400">Failed to get analysis.</p>`;
                return;
            }
            const { score, suggestions } = analysis;
            const suggestionsHTML = suggestions.map(s => `<li class="text-gray-300">${s.replace(/\*\*(.*?)\*\*/g, '<strong class="font-semibold text-violet-300">$1</strong>')}</li>`).join('');
            const scoreColor = score >= 85 ? 'text-emerald-400' : (score >= 60 ? 'text-yellow-400' : 'text-red-400');
            aiAnalysisOutput.innerHTML = `
                <div class="flex items-center mb-3">
                    <p class="font-semibold text-gray-200">Suitability Score: </p>
                    <p class="ml-2 font-bold text-lg ${scoreColor}">${score}%</p>
                </div>
                <p class="font-semibold mb-2 text-gray-200">Suggestions:</p>
                <ul class="list-disc list-inside space-y-2 text-sm">${suggestionsHTML}</ul>`;
        };
        
        const handleButtonClick = async (button, spinner, action, isDebug = false) => {
            button.disabled = true;
            spinner.classList.remove('hidden');
            
            if (action === 'execute') {
                executeCode(isDebug);
            } else if (action === 'analyze') {
                const problemText = problemInput.value.trim();
                const codeText = codeInput.value.trim();
                
                if (!problemText || !codeText) {
                    aiAnalysisOutput.innerHTML = `<p class="text-yellow-400">Please enter a problem description and some code before analyzing.</p>`;
                } else {
                    aiAnalysisOutput.innerHTML = `<div class="flex items-center gap-2 text-gray-400"><div class="spinner"></div><span>Analyzing your code with Gemini...</span></div>`;
                    const lang = languageSelect.value;
                    const analysis = await getGeminiAnalysis(problemText, codeText, lang);
                    displayAIAnalysis(analysis);
                }
                // Switch to AI tab automatically
                switchTab('aiTab');
            }
            
            button.disabled = false;
            spinner.classList.add('hidden');
        };

        const switchTab = (tabId) => {
            tabContents.forEach(content => content.classList.add('hidden'));
            tabButtons.forEach(button => button.classList.remove('active'));
            document.getElementById(tabId).classList.remove('hidden');
            document.querySelector(`[data-tab='${tabId}']`).classList.add('active');
        };
        
        // --- Event Listeners ---
        runBtn.addEventListener('click', () => {
            switchTab('outputTab');
            handleButtonClick(runBtn, runSpinner, 'execute', false);
        });
        debugBtn.addEventListener('click', () => {
            switchTab('outputTab');
            handleButtonClick(debugBtn, debugSpinner, 'execute', true);
        });
        analyzeBtn.addEventListener('click', () => handleButtonClick(analyzeBtn, analyzeSpinner, 'analyze'));

        tabButtons.forEach(button => {
            button.addEventListener('click', () => switchTab(button.dataset.tab));
        });

        languageSelect.addEventListener('change', (event) => {
            const isJs = event.target.value === 'javascript';
            [runBtn, debugBtn].forEach(btn => {
                btn.disabled = !isJs;
                btn.title = isJs ? "" : "Execution is only available for JavaScript.";
                btn.classList.toggle('opacity-50', !isJs);
                btn.classList.toggle('cursor-not-allowed', !isJs);
            });
        });
        
        codeInput.addEventListener('keydown', function(e) {
            if (e.key === 'Tab') {
                e.preventDefault();
                var start = this.selectionStart, end = this.selectionEnd;
                this.value = this.value.substring(0, start) + "  " + this.value.substring(end);
                this.selectionStart = this.selectionEnd = start + 2;
            }
        });

        // Initialize editor state
        document.addEventListener('DOMContentLoaded', () => {
            codeInput.value = '';
            // Initial check for run/debug buttons
            languageSelect.dispatchEvent(new Event('change'));
        });
    </script>
</body>
</html>

